장바구니 상품 주문하기
===

장바구니 목록 중 체크박스가 선택된 상품을 주문하는 로직을 작성하겠습니다.

장바구니에서 주문을 하면 기존 주문 로직과의 차이점은 여러 개의 상품을 하나의 주문에 담을 수 있다는 점과 주문한 상품은 장바구니에서 삭제해야 한다는점이다.

CartOrder
===

    import lombok.Getter;
    import lombok.Setter;

    import java.util.List;

    @Getter
    @Setter
    public class CartOrderDto {

        private Long cartItemId;

        private List<CartOrderDto> cartOrderDtoList;//1

    }

//1 장바구니에서 여러 개의 상품을 주문하니깐 CartOrderDto 클래스가 자기 자신을 List로 가지고 있도록 만들겠습니다.

OrderService 클래스에 장바구니에서 주문할 상품 데이터를 전달 받아서 주문을 생성하는 로직을 만들겠습니다.

OrderService
===


    @Service
    @Transactional
    @RequiredArgsConstructor
    public class OrderService {

        -코드 생략-

        public Long orders(List<OrderDto> orderDtoList, String email){

            Member member = memberRepository.findByEmail(email);
            List<OrderItem> orderItemList = new ArrayList<>();

            for (OrderDto orderDto : orderDtoList) {//1 주문할 리스트를 생성합니다.
                Item item = itemRepository.findById(orderDto.getItemId())
                    .orElseThrow(EntityNotFoundException::new);

            OrderItem orderItem = OrderItem.createOrderItem(item, orderDto.getCount());
            orderItemList.add(orderItem);
        }

        Order order = Order.createOrder(member, orderItemList);//2 현재 로그인한 회원과 주문 상품 목록을 이용하여 주문 엔티티를 만듭니다.
        orderRepository.save(order);//3 주문 데이터를 저장합니다.

        return order.getId();
    }

  }


