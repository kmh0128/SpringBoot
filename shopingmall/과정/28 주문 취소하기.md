주문 취소하기
===

상품의 재고를 더해주기 위해서 Item 클래스에 addStock 메소드를 생성합니다.

Item.java
===

  @Entity
  @Table(name="item")
  @Getter
  @Setter
  @ToString
  public class Item extends BaseEntity {

      -코드 생략-

      public void addStock(int stockNumber){//1 상품의 재고를 증가시키는 메소드입니다.
          this.stockNumber += stockNumber;
      }

  }

주문을 취소할 경우 주문 수량만큼 상품의 재고를 증가시키는 메소드를 구현합니다.

OrderItem.java
===

  @Entity
  @Getter @Setter
  public class OrderItem extends BaseEntity {

    -코드 생략-

      public void cancel() {//1 주문 취소 시 주문 수량 만큼 상품의 재고를 더해준다.
          this.getItem().addStock(count);
      }

  }


Item 클래스에 주문 취소 시 주문 수량을 상품의 재고에 더해주는 로직과 주문 상태를 취소 상태로 바꿔주는 메소드를 구현합니다.

Order.java
===

  @Entity
  @Table(name = "orders")
  @Getter @Setter
  public class Order extends BaseEntity {

       -코드 생략-

      public void cancelOrder() {
          this.orderStatus = OrderStatus.CANCEL;
          for (OrderItem orderItem : orderItems) {
              orderItem.cancel();
          }
      }

}

OrderService
===


  @Service
  @Transactional
  @RequiredArgsConstructor
  public class OrderService {

    - 코드 생략 -

      @Transactional(readOnly = true)
      public boolean validateOrder(Long orderId, String email){//1
          Member curMember = memberRepository.findByEmail(email);
          Order order = orderRepository.findById(orderId)
                  .orElseThrow(EntityNotFoundException::new);
          Member savedMember = order.getMember();

          if(!StringUtils.equals(curMember.getEmail(), savedMember.getEmail())){
              return false;
          }

          return true;
      }

      public void cancelOrder(Long orderId){
          Order order = orderRepository.findById(orderId)
                  .orElseThrow(EntityNotFoundException::new);
          order.cancelOrder();//2
      }

  }

/*

1 현재 로그인한 사용자와 주문 데이터를 생성한 사용자가 같은지 검사를 합니다.

같을 때는 true를 반환하고 같지않을 경우는 false를 반환합니다.

2 주문 취소 상태로 변경하면 변경 감지 기능에 의해서 트랜잭션이 끝날 때 update 쿼리가 실행됩니다.

*/
