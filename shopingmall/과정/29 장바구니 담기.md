장바구니 담기
====

상품 상세 페이지에서 장바구니에 담을 수량을 선택하고 장바구니 담기 버튼을 클릭할 때 상품이 장바구니에 담기는 기능을 먼저 구현

CartItemDto
===

    @Getter @Setter
    public class CartItemDto {

        @NotNull(message = "상품 아이디는 필수 입력 값 입니다.")
        private Long itemId;

        @Min(value = 1, message = "최소 1개 이상 담아주세요")
        private int count;
    }

회원 한 명당 1개의 장바구니를 갖으므로 처음 장바구니에 상품을 담을 때는 해당 회원의 장바구니를 생성해줘야 합니다.

Cart 클래스에 회원 엔티티를 파라미터로 받아서 장바구니 엔티티를 생성하는 로직을 추가합니다.

Cart
===

  @Entity
  @Table(name = "cart")
  @Getter @Setter
  @ToString
  public class Cart extends BaseEntity {

      @Id
      @Column(name = "cart_id")
      @GeneratedValue(strategy = GenerationType.AUTO)
      private Long id;

      @OneToOne(fetch = FetchType.LAZY)
      @JoinColumn(name="member_id")
      private Member member;

      public static Cart createCart(Member member){
          Cart cart = new Cart();
          cart.setMember(member);
          return cart;
      }

  }

장바구니에 담을 상품 엔티티를 생성하는 메소드와 장바구니에 담을 수량을 증가시켜 주는 메소드를 CartItem 클래스에 추가합니다.

CartItem
===

    @Entity
    @Getter @Setter
    @Table(name="cart_item")
    public class CartItem extends BaseEntity {



        public static CartItem createCartItem(Cart cart, Item item, int count) {
            CartItem cartItem = new CartItem();
            cartItem.setCart(cart);
            cartItem.setItem(item);
            cartItem.setCount(count);
            return cartItem;
        }

        public void addCount(int count){//1 장바구니에 기존에 담겨 있느 상품인데, 해당 삼품을 추가로 장바구니에 담을 때 기존 수량에 현재 담을 수량을 더해줄 메소드
            this.count += count;
        }

        public void updateCount(int count){
            this.count = count;
        }

    }

CartRepository
===

        import com.shop.entity.Cart;
        import org.springframework.data.jpa.repository.JpaRepository;

        public interface CartRepository extends JpaRepository<Cart, Long> {

            Cart findByMemberId(Long memberId);

        }

회원의 Cart 엔티티를 찾기 위해서 CartRepository에 쿼리메소드를 추가

CartItemRepository
===

장바구니에 들어갈 상품을 저장하거나 조회하기 위해서 리포지토리 패키지에 CartItemRepository 인터페이스를 생성합니다.

        import com.shop.entity.CartItem;
        import org.springframework.data.jpa.repository.JpaRepository;

        import com.shop.dto.CartDetailDto;
        import org.springframework.data.jpa.repository.Query;
        import java.util.List;

        public interface CartItemRepository extends JpaRepository<CartItem, Long> {

            CartItem findByCartIdAndItemId(Long cartId, Long itemId);//1
        }

//1 카트 아이디와 상품 아이디를 이용해서 상품이 장바구니에 들어있는지 조회합니다.

CartService
===

@Service
@RequiredArgsConstructor
@Transactional
public class CartService {

    private final ItemRepository itemRepository;
    private final MemberRepository memberRepository;
    private final CartRepository cartRepository;
    private final CartItemRepository cartItemRepository;
    private final OrderService orderService;

    public Long addCart(CartItemDto cartItemDto, String email){

        Item item = itemRepository.findById(cartItemDto.getItemId())
                .orElseThrow(EntityNotFoundException::new);
        Member member = memberRepository.findByEmail(email);

        Cart cart = cartRepository.findByMemberId(member.getId());
        if(cart == null){
            cart = Cart.createCart(member);
            cartRepository.save(cart);
        }

        CartItem savedCartItem = cartItemRepository.findByCartIdAndItemId(cart.getId(), item.getId());

        if(savedCartItem != null){
            savedCartItem.addCount(cartItemDto.getCount());
            return savedCartItem.getId();
        } else {
            CartItem cartItem = CartItem.createCartItem(cart, item, cartItemDto.getCount());
            cartItemRepository.save(cartItem);
            return cartItem.getId();
        }
    }

}

장바구니에 상품을 담는 로직을 작성하기 위해서 service 패키지 아래에 CartService 클래스를 생성


  
// 카트 아이디와 상품 아이디를 이용해서 상품이 장바구니에 들어있는지 조회합니다.
